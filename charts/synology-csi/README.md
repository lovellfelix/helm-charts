# Synology CSI Chart for Kubernetes

This is a
[Helm](https://helm.sh) chart for installing the
[Synology CSI Driver](https://github.com/SynologyOpenSource/synology-csi) in a
[Kubernetes](https://kubernetes.io) cluster.
It has been forked from the original resource manifests bundled with the Synology CSI Driver in order to resolve some
issues and to benefit from the advanced resource management features of Helm.


**Homepage:** <https://github.com/lovellfelix/helm-charts/>

## Features

+ Customizable images, image pull policies and image tags for all CSI containers.
+ Customizable parameters for `StorageClass` and `VolumeSnapshotClass` resources.
+ Automatic installation of two storage classes with `reclaimPolicy=Delete` and `reclaimPolicy=Retain`.
+ Automatic installation of a CSI Snapshotter if the `VolumeSnapshotClass` CRD is installed in your cluster.

## Prerequisites

+ A Synology Diskstation with the SAN Manager package installed (the package name was changed in DSM 7).
+ A cluster with [Kubernetes](https://kubernetes.io) version 1.19 or later.
+ `iscsiadm` installed on every cluster node.
+ `kubectl` installed on your localhost and configured to connect to the cluster.
+ Optional: [CSI Snapshotter](https://github.com/kubernetes-csi/external-snapshotter) installed in the cluster.

### Editing the Configuration

Edit the file `values.yaml` and configure it to suit your requirements.
In particular, edit the section `connections` to match the connection parameters and credentials for accessing your
Synology Diskstation.
It's a good practice to create a dedicated user for accessing the Diskstation Manager (DSM) application.
Your user needs to be a member of the `administrator` group and have permission to access the `DSM` application.
You can reject any other permissions.

### Installing the Chart

You can run `helm install ...` as usual.
However, for convenience we recommend using the provided `Makefile` and run:

    $ make up

... or just:

    $ make

## Source Code

* <https://github.com/SynologyOpenSource/synology-csi/tree/main>

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| connections[0].host | string | `"192.168.1.1"` |  |
| connections[0].https | bool | `false` |  |
| connections[0].password | string | `"password"` |  |
| connections[0].port | int | `5000` |  |
| connections[0].username | string | `"username"` |  |
| connections[1].host | string | `"192.168.1.1"` |  |
| connections[1].https | bool | `false` |  |
| connections[1].password | string | `"password"` |  |
| connections[1].port | int | `5001` |  |
| connections[1].username | string | `"username"` |  |
| fullnameOverride | string | `""` |  |
| images.attacher.image | string | `"k8s.gcr.io/sig-storage/csi-attacher"` |  |
| images.attacher.imagePullPolicy | string | `"IfNotPresent"` |  |
| images.attacher.tag | string | `"v3.3.0"` |  |
| images.nodeDriverRegistrar.image | string | `"k8s.gcr.io/sig-storage/csi-node-driver-registrar"` |  |
| images.nodeDriverRegistrar.imagePullPolicy | string | `"IfNotPresent"` |  |
| images.nodeDriverRegistrar.tag | string | `"v2.3.0"` |  |
| images.provisioner.image | string | `"k8s.gcr.io/sig-storage/csi-provisioner"` |  |
| images.provisioner.imagePullPolicy | string | `"IfNotPresent"` |  |
| images.provisioner.tag | string | `"v3.0.0"` |  |
| images.resizer.image | string | `"k8s.gcr.io/sig-storage/csi-resizer"` |  |
| images.resizer.imagePullPolicy | string | `"IfNotPresent"` |  |
| images.resizer.tag | string | `"v1.3.0"` |  |
| images.snapshotter.image | string | `"k8s.gcr.io/sig-storage/csi-snapshotter"` |  |
| images.snapshotter.imagePullPolicy | string | `"IfNotPresent"` |  |
| images.snapshotter.tag | string | `"v4.2.1"` |  |
| nameOverride | string | `""` |  |
| storageClasses.delete.reclaimPolicy | string | `"Delete"` |  |
| storageClasses.retain.reclaimPolicy | string | `"Retain"` |  |
| volumeSnapshotClasses.delete | object | `{}` |  |
| volumeSnapshotClasses.retain.deletionPolicy | string | `"Retain"` |  |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs v1.6.0](https://github.com/norwoodj/helm-docs/releases/v1.6.0)
